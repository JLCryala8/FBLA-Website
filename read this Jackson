// put this at the top
const API_URL = "http://localhost:8080/users";

async function fetchUsers() {
  const response = await fetch(API_URL);
  if (!response.ok) throw new Error("Failed to fetch users");
  return await response.json();
}

async function createUser(data) {
  const response = await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  if (!response.ok) throw new Error("Failed to create user");
  return await response.json();
}

async function deleteUser(id) {
  await fetch(`${API_URL}/${id}`, {
    method: "DELETE"
  });
}

// render items
async function renderItems() {
  const output = document.getElementById("output");
  if (!output) return;

  output.innerHTML = "";

  try {
    const users = await fetchUsers();

    users.forEach(user => {
      const div = document.createElement("div");
      div.className = "card";

      div.innerHTML = `
        <h3>${user.itemName}</h3>
        <p><strong>Name:</strong> ${user.name}</p>
        <p><strong>Description:</strong> ${user.itemDescription}</p>
        <p><strong>Date:</strong> ${user.date}</p>
        <p><strong>Category:</strong> ${user.category}</p>
        <p><strong>Location:</strong> ${user.location}</p>
        <p><strong>Status:</strong> ${user.isFound ? "Found" : "Lost"}</p>
        <img src="${API_URL}/${user.userNumber}/image" 
             alt="Item Image"
             style="max-width:200px; display:block; margin-top:10px;"
             onerror="this.style.display='none'" />
        <button onclick="handleDelete('${user.id}')">Delete</button>
        <hr/>
      `;

      output.appendChild(div);
    });

  } catch (err) {
    console.error(err);
  }
}

// delete
async function handleDelete(id) {
  if (!confirm("Delete this item?")) return;

  await deleteUser(id);
  renderItems();
}
// upload documents
document.addEventListener("DOMContentLoaded", function() {

  const form = document.getElementById("reportForm");

  if (form) {
    form.addEventListener("submit", async function(e) {
      e.preventDefault();

      const data = {
        name: document.getElementById("name").value,
        itemName: document.getElementById("itemName").value,
        itemDescription: document.getElementById("itemDescription").value,
        date: document.getElementById("date").value,
        category: document.getElementById("category").value,
        location: document.getElementById("location").value,
        isFound: false
      };

      const createdUser = await createUser(data);

      // If image selected, upload it
      const fileInput = document.getElementById("imageInput");
      if (fileInput && fileInput.files.length > 0) {
        await uploadImage(createdUser.userNumber);
      }

      form.reset();
      renderItems();
    });
  }

  renderItems();
});

// upload image
async function uploadImage(userNumber) {
  const fileInput = document.getElementById("imageInput");
  const file = fileInput.files[0];

  if (!file) return;

  const formData = new FormData();
  formData.append("file", file);

  await fetch(`${API_URL}/${userNumber}/image`, {
    method: "POST",
    body: formData
  });
}
<form id="reportForm">

  <input type="text" id="name" placeholder="Your Name" required>
  <input type="text" id="itemName" placeholder="Item Name" required>
  <input type="text" id="itemDescription" placeholder="Description" required>
  <input type="date" id="date" required>
  <input type="text" id="category" placeholder="Category" required>
  <input type="text" id="location" placeholder="Location" required>

  <!-- ðŸ”¥ THIS IS THE IMAGE INPUT -->
  <input type="file" id="imageInput" accept="image/*">

  <button type="submit">Submit</button>

</form>
